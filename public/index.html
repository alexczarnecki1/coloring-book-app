<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coloring‑Book Generator</title>
    <!-- Tailwind Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Notion‑like grey canvas */
      body { background-color:#f5f4f2; }
      /* subtle scrollbar */
      ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-thumb{background:#d4d4d4;border-radius:3px}
    </style>
  </head>
  <body class="min-h-screen flex flex-col items-center py-14 px-4 text-stone-800">
    <h1 class="text-3xl font-semibold mb-10">Coloring‑Book Generator</h1>

    <!-- Outer card -->
    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-sm border border-stone-200 p-8 space-y-8">

      <!-- Drop zone -->
      <label id="dropZone" class="flex flex-col items-center justify-center w-full h-56 rounded-xl border-2 border-dashed border-stone-300 hover:border-indigo-400 transition-colors cursor-pointer bg-stone-50">
        <input id="imageUpload" type="file" accept="image/*" class="hidden" />
        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-stone-400 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v3a1 1 0 001 1h3m6 0h3a1 1 0 001-1v-3m0-6V7a1 1 0 00-1-1h-3m-6 0H5a1 1 0 00-1 1v3m5-3v12m0 0l-3-3m3 3l3-3" /></svg>
        <p class="text-sm text-stone-500">Drag & drop or click to upload</p>
      </label>

      <!-- Controls card -->
      <div class="space-y-4">
        <label for="styleSelect" class="block text-sm font-medium text-stone-700">Choose style</label>
        <select id="styleSelect" class="w-full rounded-lg border-stone-300 focus:ring-indigo-500 focus:border-indigo-500">
          <option value="original" selected>Just like the photo</option>
          <option value="anime">Anime style</option>
          <option value="ghibli">Studio Ghibli style</option>
        </select>

        <button id="generateBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg transition-colors">Generate Coloring Page</button>
      </div>

      <!-- Result -->
      <div id="resultBox" class="hidden flex flex-col items-center space-y-4">
        <p class="text-stone-600 text-sm">Your Coloring Book Image:</p>
        <img id="generatedImage" class="max-w-full rounded-lg shadow border border-stone-200" />
      </div>
    </div>

    <!-- Script -->
    <script>
      const dropZone   = document.getElementById('dropZone');
      const imageInput = document.getElementById('imageUpload');
      const styleSel   = document.getElementById('styleSelect');
      const generateBtn= document.getElementById('generateBtn');
      const imgEl      = document.getElementById('generatedImage');
      const resultBox  = document.getElementById('resultBox');

      // drag‑drop UX
      ;['dragenter','dragover'].forEach(evt=>dropZone.addEventListener(evt,e=>{e.preventDefault();dropZone.classList.add('border-indigo-400')}));
      ;['dragleave','drop'].forEach(evt=>dropZone.addEventListener(evt,e=>{e.preventDefault();dropZone.classList.remove('border-indigo-400')}));
      dropZone.addEventListener('drop', e=>{imageInput.files=e.dataTransfer.files;});

      generateBtn.addEventListener('click', async () => {
        if (!imageInput.files[0]) { alert('Please select an image first'); return; }

        const formData = new FormData();
        formData.append('image', imageInput.files[0]);
        formData.append('style', styleSel.value);

        generateBtn.disabled = true;
        generateBtn.textContent = 'Generating…';

        const controller = new AbortController();
        const timeoutId  = setTimeout(()=>controller.abort(), 120000);
        try {
          const res = await fetch('/api/generate', { method:'POST', body:formData, signal:controller.signal });
          clearTimeout(timeoutId);
          if (!res.ok) throw new Error(await res.text());
          const data = await res.json();
          imgEl.src = `data:image/png;base64,${data.imageBase64}`;
          imgEl.classList.add('w-full');
          resultBox.classList.remove('hidden');
        } catch(err) {
          alert('Error: '+err.message);
          console.error(err);
        } finally {
          generateBtn.disabled = false;
          generateBtn.textContent = 'Generate Coloring Page';
        }
      });
    </script>
  </body>
</html>


